@model IEnumerable<DataAccessLayer.Models.ViewModel.RoleVM>
@{
    ViewData["Title"] = "Index";
}

<h1>Role</h1>
<button id="createButton">Create</button>

<table class="table table-bordered table-striped table-hover">
    <thead>
        <tr>
            <th>
                Name
            </th>
            <th>
                Action
            </th>

        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
            <tr>
                <td>
                    @Html.DisplayFor(modelItem => item.RoleName)
                </td>
                
                <td>
                    <a class="btn btn-primary" asp-action="Edit" asp-route-id="@item.RoleId">Edit</a> |
                    <a class="btn btn-danger" onclick="openDeleteModal('@item.RoleId')">Delete</a>
                </td>
            </tr>
        }
    </tbody>

</table>

<div class="modal fade" id="modal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title text-black" id="exampleModalLabel">Delete Role !!</h3>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-capitalize text-danger">
                You are deleting a Role....after clicking on "Delete" button it wont be undone and it will be deleted forever!
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-dark" data-bs-dismiss="modal">Cancel</button>
                <button type="button" onclick="confirmDelete()" class="btn btn-outline-danger">OK</button>
            </div>
        </div>
    </div>
</div>



<!-- Pop-up Modal -->
<div id="popupModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <input type="text" id="inputText" placeholder="Enter something..." />
        <button id="submitButton">Submit</button>
        <div id="responseMessage"></div>
    </div>
</div>

<!-- CSS -->
<style>
    .modal {
        display: none;
        position: fixed;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
    }

    .modal-content {
        background-color: white;
        margin: 20% auto;
        padding: 20px;
        width: 300px;
        text-align: center;
    }

    .close {
        float: right;
        cursor: pointer;
    }
</style>


<script>
        document.addEventListener("DOMContentLoaded", function () {
        var modal = document.getElementById("popupModal");
        var createButton = document.getElementById("createButton");
        var closeButton = document.querySelector(".close");

        createButton.addEventListener("click", function () {
            modal.style.display = "block";
        });

        closeButton.addEventListener("click", function () {
            modal.style.display = "none";
        });

        window.addEventListener("click", function (event) {
            if (event.target === modal) {
                modal.style.display = "none";
            }
        });


        $("#submitButton").click(function () {
             var inputText = $("#inputText").val();
             $.ajax({
                url: "/Role/Create",
                type: "POST",
                contentType: "application/json",
                data: JSON.stringify({ roleName: inputText }),
                success: function (response) {
                    $("#responseMessage").html("<p style='color:green;'> Successful!</p>");
                    window.location.href = response.redirectUrl; 
                },
                error: function (xhr) {
                 if (xhr.status === 400) { 
                        var response = JSON.parse(xhr.responseText);
                        if (response.errors) {
                            var errorList = response.errors.map(e => `<li>${e}</li>`).join("");
                            $("#errorMessage").html(`<div class='error' style='color:red;'>${errorList}</div>`);
                        } 
                    } 
                    else {
                        $("#responseMessage").html("<p style='color:red;'>An error occurred. Please try again.</p>");
                    }
                }
            });
        });

       
    });

</script>

@section Scripts {
    <script>
        let projectIdToDelete = 0;

        function openDeleteModal(id) {
            projectIdToDelete = id;
            $("#modal").modal('show');
        }

        function confirmDelete() {
            $.ajax({
                url: `/Role/Delete/${projectIdToDelete}`,
                //url: '/Project/Delete/' + userStoryIdToDelete,
                type: 'POST',
                success: function (result) {
                    $("#modal").modal('hide');
                    location.reload();
                    console.log(result);
                },
                error: function (err) {
                    alert('Error deleting user story' + err);
                }
            });
        }
    </script>
}